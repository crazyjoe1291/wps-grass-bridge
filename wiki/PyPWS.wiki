# Installation and usage of wps-grass-bridge with PyWPS and GRASS GIS 7

= Introduction =

The wps-grass-bridge is designed to make the integration of GRASS GIS 7 in WPS server as easy as possible. Especially for PyWPS an generic approach has been implemented to attach most of the existing and future raster and vector modules to PyWPS out of the box.

It is only tested on OpenSuse Linux 11.1 and 11.2 on 32Bit and 64Bit. Other operating systems are currently not supported.

= Installation =

== Overview ==

The general principle is

  # Install GRASS GIS trunk version 7 and PyWPS trunk via svn
  # Install PyXB, which is needed to generate the PyWPS processes
  # Install PyWPS
  # Download the wps-grass-bridge via svn
  # Modify the GlobalGrassSettings.py script and test the PyWPSGrassModuleStarter.py
  # Create the XML process description for each GRASS GIS module which should be attached
  # Based on the XML files generate the PyWPS processes with GrassXMLtoPyWPS.py
  # Put the wps-grass-bridge and the generated processes into a PyWPS process directory

=== GRASS GIS 7 =installation ==

The wps-grass-bridge is based on the latest GRASS GIS 7 version, which is available as svn download. Download GRASS GIS 7 via svn into your development folder:
{{{
svn checkout https://svn.osgeo.org/grass/grass/trunk grass_trunk
}}}

Follow these compilation instruction: 
http://grass.osgeo.org/wiki/Compile_and_Install

Only compilation is needed. GRASS GIS 7 must not be installed, it will run perfectly after compilation from the dist directory.

=== PyXB Installation ===

To generate PyWPS processes PyXB is needed to parse the GRASS GIS XML WPS process description files. To install PyXB follow the install instructions located here:
http://pyxb.sourceforge.net/overview_how.html
Make sure PyXB is located in your PYTHONPATH.

=== PyWPS installation ===

PyWPS ships a very nice documentation, which describes detailed how to install, configure and use PyWPS. The documentation is available here: 
http://pywps.wald.intevation.org/documentation/index.html

=== wps-grass-bridge installation ===

The wps-grass-bridge can only be downloaded via svn, build or installation is not supported/needed. Switch into your development directory and type: 

{{{svn checkout http://wps-grass-bridge.googlecode.com/svn/trunk/ wps-grass-bridge-read-only}}}

The wps-grass-bridge including tests and test data will be downloaded.


= How to generate and use GRASS GIS processes =

All python scripts you need are located in wps-grass-bridge-read-only directory. To test the PyWPSGrassModuleStarter.py you need to modify the GlobalGrassSetting.py file. The following, mostly self explaining variables must be set correctly:

{{{
WORKDIR="/tmp"
OUTPUTDIR="/tmp"
LOGFILE="/tmp/logfile.txt"
LOGFILE_MODULE_STDOUT="/tmp/logfile_module_stdout.txt"
LOGFILE_MODULE_STDERR="/tmp/logfile_module_sterr.txt"
GRASS_GIS_BASE="/home/soeren/src/grass7.0/grass_trunk/dist.x86_64-unknown-linux-gnu"
GRASS_ADDON_PATH="gms/Testing/Python/GrassAddons"
GRASS_VERSION="7.0.svn"
}}}

Make sure the log files are accessible by your web server. The workdir is used to create the temporally GRASS GIS locations, based on the first complex raster or vector input. All results are stored as files in the outputdir.

The PyWPSGrassModuleStarter includes a test which is automatically started if you execute the script in the command line. To start the PyWPSGrassModuleStarter make sure PyWPS is in your PYTHONPATH and all GRASS GIS relevant variables are set in GlobalGrassSetting.py, then type:
{{{python PyWPSGrassModuleStarter.py}}}

This will start the test by executing v.voronoi. When successfully finished the path to the generated GML file is printed to stdout.

== XML process description generation ==

You can create valid XML process descriptions in any valid GRASS GIS location. Start grass7 and switch to the GRASS GIS shell. To generate the XML process description for r.univar just type:
{{{
r.univar --wps-process-description > /tmp/r.univar.xml
}}}

== PyWPS process generation ==

Based on the class GrassModuleStarter, which hides all the GRASS GIS overhead, a class named PyWPSGrassModuleStarter has been implemented which is used by the automatically generated PyPWS processes.
To generate PyPWS processes the GrassXMLtoPyWPS.py script is used. Before you can use this script, make sure pyxb version 1.1.2 is in the PYTHONPATH.

== Attaching the processes ==
 
Put the wps-grass-bridge and all generated processes into the PyWPS process directory. Add all processes to your __init__.py file in your process directory.